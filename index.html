<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOST V3 ç®¡ç†é¢æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }
        body {
            background: #f5f7fa;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .header h1 {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 10px;
        }
        .header p {
            color: #7f8c8d;
            font-size: 16px;
        }
        .status-card {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: #fff;
            border-radius: 8px;
            border: 1px solid #eee;
            padding: 20px;
            transition: box-shadow 0.3s;
        }
        .card:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .card .status {
            font-size: 16px;
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
            display: inline-block;
        }
        .status.running {
            background: #e8f5e9;
            color: #2ecc71;
        }
        .status.stopped {
            background: #ffebee;
            color: #e74c3c;
        }
        .card .config-item {
            margin: 8px 0;
            font-size: 14px;
            color: #555;
        }
        .card .config-item span {
            color: #2c3e50;
            font-weight: 600;
            margin-right: 8px;
        }
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.3s;
        }
        .btn-primary {
            background: #3498db;
            color: #fff;
        }
        .btn-primary:hover {
            background: #2980b9;
        }
        .btn-success {
            background: #2ecc71;
            color: #fff;
        }
        .btn-success:hover {
            background: #27ae60;
        }
        .btn-danger {
            background: #e74c3c;
            color: #fff;
        }
        .btn-danger:hover {
            background: #c0392b;
        }
        .btn-info {
            background: #17a2b8;
            color: #fff;
        }
        .btn-info:hover {
            background: #138496;
        }
        .log-viewer {
            width: 100%;
            height: 300px;
            background: #1e1e1e;
            color: #fff;
            padding: 15px;
            border-radius: 8px;
            overflow-y: auto;
            font-family: "Consolas", monospace;
            font-size: 14px;
            margin-top: 20px;
        }
        .log-error {
            color: #e74c3c;
        }
        .log-info {
            color: #3498db;
        }
        .log-success {
            color: #2ecc71;
        }
        .footer {
            text-align: center;
            margin-top: 40px;
            color: #7f8c8d;
            font-size: 14px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            .header h1 {
                font-size: 24px;
            }
            .btn-group {
                flex-direction: column;
            }
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>GOST V3 è½»é‡ç®¡ç†é¢æ¿</h1>
            <p>ä¸»æ§ç«¯/è¢«æ§ç«¯ä¸€ä½“åŒ–ç®¡ç† | å®æ—¶çŠ¶æ€ç›‘æ§</p>
        </div>

        <!-- å¿«æ·æ“ä½œæŒ‰é’® -->
        <div class="btn-group">
            <button class="btn btn-success" id="startMaster">å¯åŠ¨ä¸»æ§ç«¯</button>
            <button class="btn btn-danger" id="stopMaster">åœæ­¢ä¸»æ§ç«¯</button>
            <button class="btn btn-primary" id="restartMaster">é‡å¯ä¸»æ§ç«¯</button>
            <button class="btn btn-info" id="viewStatus">åˆ·æ–°çŠ¶æ€</button>
            <button class="btn btn-info" id="viewLog">æŸ¥çœ‹è¿è¡Œæ—¥å¿—</button>
        </div>

        <!-- çŠ¶æ€å¡ç‰‡ -->
        <div class="status-card">
            <!-- ä¸»æ§ç«¯çŠ¶æ€ -->
            <div class="card">
                <h3>ğŸ“Œ ä¸»æ§ç«¯çŠ¶æ€</h3>
                <div class="status" id="masterStatus">åŠ è½½ä¸­...</div>
                <div class="config-item"><span>gRPCç«¯å£ï¼š</span><span id="grpcPort">50051</span></div>
                <div class="config-item"><span>é¢æ¿ç«¯å£ï¼š</span><span id="httpPort">8080</span></div>
                <div class="config-item"><span>è®¤è¯å¯†é’¥ï¼š</span><span id="authKey">åŠ è½½ä¸­...</span></div>
                <div class="config-item"><span>å®‰è£…è·¯å¾„ï¼š</span>/usr/local/gost-master</div>
                <div class="config-item"><span>æ—¥å¿—è·¯å¾„ï¼š</span>/usr/local/gost-master/gost-master.log</div>
            </div>

            <!-- è¢«æ§ç«¯çŠ¶æ€ -->
            <div class="card">
                <h3>ğŸ–¥ï¸ è¢«æ§ç«¯çŠ¶æ€</h3>
                <div class="status" id="nodeStatus">æœªå®‰è£…</div>
                <div class="config-item"><span>å…³è”ä¸»æ§ï¼š</span><span id="masterGrpc">æœªé…ç½®</span></div>
                <div class="config-item"><span>å®‰è£…è·¯å¾„ï¼š</span>/usr/local/gost-node</div>
                <div class="config-item"><span>æ—¥å¿—è·¯å¾„ï¼š</span>/usr/local/gost-node/gost-node.log</div>
            </div>

            <!-- ç³»ç»Ÿä¿¡æ¯ -->
            <div class="card">
                <h3>ğŸ–§ ç³»ç»Ÿä¿¡æ¯</h3>
                <div class="config-item"><span>æœ¬æœºIPï¼š</span><span id="localIp">åŠ è½½ä¸­...</span></div>
                <div class="config-item"><span>å¤–ç½‘IPï¼š</span><span id="publicIp">åŠ è½½ä¸­...</span></div>
                <div class="config-item"><span>ç³»ç»Ÿæ¶æ„ï¼š</span><span id="sysArch">åŠ è½½ä¸­...</span></div>
                <div class="config-item"><span>æœ€ååˆ·æ–°ï¼š</span><span id="refreshTime">--</span></div>
            </div>
        </div>

        <!-- æ—¥å¿—æŸ¥çœ‹å™¨ -->
        <div id="logContainer" style="display: none;">
            <h3>ğŸ“œ ä¸»æ§ç«¯è¿è¡Œæ—¥å¿—</h3>
            <div class="log-viewer" id="logContent"></div>
        </div>

        <!-- åº•éƒ¨ -->
        <div class="footer">
            <p>GOST V3 è½»é‡ç®¡ç†è„šæœ¬ | é€‚é… CentOS7+/Ubuntu18+/Debian10+</p>
        </div>
    </div>

    <script>
        // å·¥å…·å‡½æ•°ï¼šè·å–DOMå…ƒç´ 
        const $ = (id) => document.getElementById(id);
        
        // æ›´æ–°æ—¶é—´æˆ³
        const updateRefreshTime = () => {
            const now = new Date();
            $('refreshTime').textContent = now.toLocaleString('zh-CN');
        };

        // 1. åˆå§‹åŒ–é¡µé¢ï¼šåŠ è½½åŸºç¡€ä¿¡æ¯
        window.onload = async () => {
            await loadSystemInfo();
            await loadServiceStatus();
            updateRefreshTime();
        };

        // 2. åŠ è½½ç³»ç»Ÿä¿¡æ¯ï¼ˆIPã€æ¶æ„ç­‰ï¼‰
        async function loadSystemInfo() {
            try {
                // æ¨¡æ‹Ÿè·å–ç³»ç»Ÿä¿¡æ¯ï¼ˆå®é™…éƒ¨ç½²éœ€åç«¯æ¥å£æ”¯æŒï¼‰
                // å‰ç«¯ä»…åšå±•ç¤ºï¼ŒçœŸå®æ•°æ®éœ€ä»è„šæœ¬/åç«¯æ¥å£è·å–
                const resIp = await fetch('https://ip.sb');
                const publicIp = await resIp.text();
                $('publicIp').textContent = publicIp.trim();

                // æ¶æ„/æœ¬åœ°IPéœ€åç«¯æ¥å£è¿”å›ï¼ˆç¤ºä¾‹å€¼ï¼‰
                $('sysArch').textContent = `${navigator.platform} (${window.navigator.userAgent.match(/Linux|Windows|Mac/)})`;
                $('localIp').textContent = '192.168.1.100'; // å®é™…éœ€åç«¯è¿”å›
                
                // é…ç½®ç«¯å£ï¼ˆä»è„šæœ¬é»˜è®¤å€¼è¯»å–ï¼‰
                $('grpcPort').textContent = '50051';
                $('httpPort').textContent = '8080';
                $('authKey').textContent = '**********'; // å®é™…éœ€åç«¯è¿”å›ï¼ˆè„±æ•ï¼‰
            } catch (e) {
                console.error('åŠ è½½ç³»ç»Ÿä¿¡æ¯å¤±è´¥ï¼š', e);
                $('publicIp').textContent = 'è·å–å¤±è´¥';
            }
        }

        // 3. åŠ è½½æœåŠ¡çŠ¶æ€
        async function loadServiceStatus() {
            try {
                // æ¨¡æ‹ŸæœåŠ¡çŠ¶æ€ï¼ˆå®é™…éœ€åç«¯æ¥å£è¿”å›è„šæœ¬æ‰§è¡Œç»“æœï¼‰
                // ä¸»æ§ç«¯çŠ¶æ€
                const masterRunning = true; // å®é™…éœ€åˆ¤æ–­ systemctl is-active gost-master
                if (masterRunning) {
                    $('masterStatus').textContent = 'è¿è¡Œä¸­';
                    $('masterStatus').className = 'status running';
                } else {
                    $('masterStatus').textContent = 'å·²åœæ­¢';
                    $('masterStatus').className = 'status stopped';
                }

                // è¢«æ§ç«¯çŠ¶æ€
                const nodeInstalled = false; // å®é™…éœ€åˆ¤æ–­æ˜¯å¦å®‰è£…è¢«æ§ç«¯
                if (nodeInstalled) {
                    const nodeRunning = false;
                    $('nodeStatus').textContent = nodeRunning ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢';
                    $('nodeStatus').className = nodeRunning ? 'status running' : 'status stopped';
                } else {
                    $('nodeStatus').textContent = 'æœªå®‰è£…';
                    $('nodeStatus').className = 'status stopped';
                }
            } catch (e) {
                console.error('åŠ è½½æœåŠ¡çŠ¶æ€å¤±è´¥ï¼š', e);
                $('masterStatus').textContent = 'è·å–å¤±è´¥';
                $('nodeStatus').textContent = 'è·å–å¤±è´¥';
            }
        }

        // 4. æŸ¥çœ‹æ—¥å¿—
        function viewLog() {
            const logContainer = $('logContainer');
            logContainer.style.display = logContainer.style.display === 'none' ? 'block' : 'none';
            
            if (logContainer.style.display === 'block') {
                // æ¨¡æ‹ŸåŠ è½½æ—¥å¿—ï¼ˆå®é™…éœ€åç«¯æ¥å£å®æ—¶è¿”å›ï¼‰
                $('logContent').innerHTML = `
                    <div class="log-info">[2024-05-20 10:00:00] [INFO] GOST v3.0.0 å¯åŠ¨æˆåŠŸ</div>
                    <div class="log-info">[2024-05-20 10:00:01] [INFO] gRPCç›‘å¬ 0.0.0.0:50051</div>
                    <div class="log-success">[2024-05-20 10:00:02] [INFO] é¢æ¿ç›‘å¬ 0.0.0.0:8080</div>
                    <div class="log-info">[2024-05-20 10:00:03] [INFO] è®¤è¯å¯†é’¥ï¼š**********</div>
                `;
            }
        }

        // 5. ç»‘å®šæŒ‰é’®äº‹ä»¶
        $('startMaster').addEventListener('click', async () => {
            alert('å·²æ‰§è¡Œï¼šå¯åŠ¨ä¸»æ§ç«¯ï¼ˆå®é™…éœ€è°ƒç”¨åç«¯æ¥å£æ‰§è¡Œ systemctl start gost-master nginxï¼‰');
            await loadServiceStatus();
            updateRefreshTime();
        });

        $('stopMaster').addEventListener('click', async () => {
            alert('å·²æ‰§è¡Œï¼šåœæ­¢ä¸»æ§ç«¯ï¼ˆå®é™…éœ€è°ƒç”¨åç«¯æ¥å£æ‰§è¡Œ systemctl stop gost-master nginxï¼‰');
            await loadServiceStatus();
            updateRefreshTime();
        });

        $('restartMaster').addEventListener('click', async () => {
            alert('å·²æ‰§è¡Œï¼šé‡å¯ä¸»æ§ç«¯ï¼ˆå®é™…éœ€è°ƒç”¨åç«¯æ¥å£æ‰§è¡Œ systemctl restart gost-master nginxï¼‰');
            await loadServiceStatus();
            updateRefreshTime();
        });

        $('viewStatus').addEventListener('click', async () => {
            await loadServiceStatus();
            await loadSystemInfo();
            updateRefreshTime();
            alert('çŠ¶æ€å·²åˆ·æ–°ï¼');
        });

        $('viewLog').addEventListener('click', viewLog);
    </script>
</body>
</html>
